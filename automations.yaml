- id: '1531068777832'
  alias: Nightly rain
  initial_state: 'off'
  trigger:
  - at: '21:00'
    platform: time
  condition:
  - condition: template
    value_template: '{% set p = states.sensor.rain_probability.attributes.hourly.data[1:12]
      | map(attribute="precipProbability") | list %} {% set pNoRain = (1 - p[0]) *
      (1 - p[1]) * (1 - p[2]) * (1 - p[3]) * (1 - p[4]) * (1 - p[5]) * (1 - p[6])
      * (1 - p[7]) * (1 - p[8]) * (1 - p[9]) * (1 - p[10]) %} {{ (1 - pNoRain) >=
      0.2 }}'
  action:
  - data:
      message: Stäng fönster och ta in dynor.
      title: Rain during night
    service: notify.pushbullet_notifier
- id: '1531143646436'
  alias: Upcoming rain alert
  initial_state: 'off'
  trigger:
  - platform: template
    value_template: '{% set p = states.sensor.rain_probability.attributes.hourly.data[1:4]
      | map(attribute="precipProbability") | list %} {% set pNoRain = (1 - p[0]) *
      (1 - p[1]) * (1 - p[2]) %} {{ (1 - pNoRain) >= 0.15 }}'
  condition:
  - condition: template
    value_template: "{{ \n(states.automation.upcoming_rain_alert.attributes.last_triggered\
      \ == None) or\n\n(as_timestamp(now()) - as_timestamp(states.automation.upcoming_rain_alert.attributes.last_triggered))\
      \ / 60  > 180 }}"
  action:
  - data:
      message: It will probably rain soon
      title: Rain alert
    service: notify.pushbullet_notifier
- id: '1532183349901'
  alias: Sunset
  trigger:
  - event: sunset
    offset: -00:30
    platform: sun
  condition: []
  action:
  - data:
      brightness_pct: 10
      entity_id: light.gateway_light_7811dcdf0cfa
      rgb_color:
      - 255
      - 255
      - 35
    service: light.turn_on
  - data:
      brightness_pct: 100
      kelvin: 2700
    service: light.turn_on
    target:
      entity_id:
      - light.yeelight_color_0x5ed30a8
  - data:
      brightness_pct: 100
      kelvin: 5000
    service: light.turn_on
    target:
      entity_id:
      - light.yeelight_color_0x5ed2368
  - data: {}
    service: switch.turn_on
    target:
      entity_id:
      - switch.outlet_lamp_living_room
      - switch.outlet_living_room_right
      - switch.tv_room_window_lamps_switch
      - switch.guestroomwindow
      - switch.window_upper_floor
  - service: script.turn_on_left_closet
  - service: script.turn_on_right_closet
  initial_state: 'on'
  mode: single
- id: '1532183940727'
  alias: Sunrise
  trigger:
  - event: sunrise
    offset: 00:15
    platform: sun
  condition: []
  action:
  - data:
      entity_id: light.gateway_light_7811dcdf0cfa
    service: light.turn_off
  - service: light.turn_off
    data: {}
    target:
      entity_id:
      - light.yeelight_color_0x5ed30a8
  - service: light.turn_off
    data: {}
    target:
      entity_id:
      - light.yeelight_color_0x5ed2368
  - data: {}
    service: switch.turn_off
    target:
      entity_id:
      - switch.outlet_lamp_living_room
      - switch.outlet_living_room_right
      - switch.guestroomwindow
      - switch.tv_room_window_lamps_switch
      - switch.window_upper_floor
  initial_state: 'on'
  mode: single
- id: '1533203159068'
  alias: Doors - Entrance opens
  trigger:
  - entity_id: binary_sensor.door_window_sensor_158d0002049a62
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: input_boolean.silent_mode
    state: 'off'
  action:
  - data:
      gw_mac: 04:CF:8C:91:62:CB
      ringtone_id: 29
      ringtone_vol: 8
    service: xiaomi_aqara.play_ringtone
  - delay: 00:00:01
  - data:
      gw_mac: 04:CF:8C:91:62:CB
    service: xiaomi_aqara.stop_ringtone
  initial_state: 'on'
- id: '1533223349979'
  alias: Doors - Terrass opens
  trigger:
  - entity_id: binary_sensor.door_window_sensor_158d000204bac9
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: binary_sensor.door_window_sensor_158d0002048620
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: binary_sensor.door_window_sensor_158d00022eff91
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: input_boolean.silent_mode
    state: 'off'
  action:
  - data:
      gw_mac: 04:CF:8C:91:62:CB
      ringtone_id: 20
      ringtone_vol: 8
    service: xiaomi_aqara.play_ringtone
  - delay:
      milliseconds: 850
  - data:
      gw_mac: 04:CF:8C:91:62:CB
    service: xiaomi_aqara.stop_ringtone
  initial_state: 'on'
  mode: single
- id: '1535117514847'
  alias: Media - Play
  trigger:
  - entity_id: media_player.vardagsrum
    platform: state
    to: playing
  condition:
  - condition: state
    entity_id: group.tv_room_rgb_lights
    state: 'on'
  - after: '18:00'
    before: 06:00
    condition: time
  action:
  - data:
      brightness_pct: 10
      entity_id: group.tv_room_rgb_lights
      color_temp: 431
    service: light.turn_on
  initial_state: 'on'
- id: '1535128483194'
  alias: Media - Stop
  trigger:
  - entity_id: media_player.vardagsrum
    for: 0:00:15
    from: playing
    platform: state
    to: idle
  - entity_id: media_player.vardagsrum
    for: 0:00:15
    platform: state
    to: 'off'
  condition:
  - condition: state
    entity_id: group.tv_room_rgb_lights
    state: 'on'
  - after: '18:00'
    before: 06:00
    condition: time
  action:
  - data:
      entity_id: script.1536574687151
    service: script.turn_on
  initial_state: 'on'
- id: '1536864983273'
  alias: Fire alarm
  initial_state: 'on'
  trigger:
  - entity_id: binary_sensor.smoke_sensor_158d00023117bb
    platform: state
    to: 'on'
  - entity_id: binary_sensor.smoke_sensor_158d000215ab06
    platform: state
    to: 'on'
  condition: []
  action:
  - data:
      message: Possible fire in kitchen/tvroom
      title: Possible fire
    service: notify.pushbullet_notifier
- id: '1536961274860'
  alias: Coming home
  trigger:
  - entity_id: device_tracker.huawei_p30_pro_34dabc024f
    platform: state
    to: home
  - entity_id: group.trusted_people
    platform: state
    to: home
  - platform: state
    entity_id: input_boolean.front_door_unlocked
    from: 'off'
    to: 'on'
    for: 00:01:45
  condition: []
  action:
  - service: light.turn_on
    entity_id: light.hallway_lights
    data: {}
  - service: input_boolean.turn_off
    entity_id: input_boolean.identification_pending
    data: {}
  - data:
      duration: 180000
      light: light.yeelight_color_0x0000000005ed2368
    service: script.temp_max_light_yeelight
  initial_state: 'on'
  mode: single
- id: '1538080363136'
  alias: Leaving home
  trigger:
  - entity_id: group.trusted_people
    from: home
    platform: state
    to: not_home
  condition:
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  action:
  - data: {}
    service: light.turn_off
    target:
      entity_id:
      - group.tv_room_rgb_lights
      - light.hallway_lights
      - light.tv_room_cieling_lights
  - data:
      entity_id: switch.outlet_kaffebryggaren
    service: switch.turn_off
  initial_state: 'on'
- id: '1540397582929'
  alias: Sleeping
  trigger:
  - entity_id: input_boolean.sleeping
    from: 'off'
    platform: state
    to: 'on'
  condition: []
  action:
  - data: {}
    service: light.turn_off
    target:
      entity_id:
      - light.gateway_light_7811dcdf0cfa
      - light.yeelight_color_0x5ed30a8
      - light.yeelight_color_0x5ed2368
      - light.kitchen_spotlights
      - light.tv_room_cieling_lights
  - data:
      entity_id: group.tv_room_rgb_lights
    service: light.turn_off
  - data: {}
    service: switch.turn_off
    target:
      entity_id:
      - switch.outlet_lamp_living_room
      - switch.outlet_living_room_right
  - data:
      entity_id: input_boolean.tv_room_light_switched_recently_pressed
    service: input_boolean.turn_off
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  - data:
      entity_id: group.office_cieling_light
    service: light.turn_off
  - service: switch.turn_off
    data: {}
    entity_id: switch.tv_room_window_lamps_switch
  initial_state: 'on'
  mode: single
- id: '1540397737368'
  alias: Waking up
  trigger:
  - entity_id: input_boolean.sleeping
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - condition: or
    conditions:
    - before: sunrise
      condition: sun
    - after: sunset
      condition: sun
  action:
  - data:
      brightness_pct: 100
      kelvin: 2700
    service: light.turn_on
    target:
      entity_id:
      - light.yeelight_color_0x5ed30a8
      - light.yeelight_color_0x5ed2368
  - data: {}
    service: switch.turn_on
    target:
      entity_id:
      - switch.outlet_lamp_living_room
      - switch.outlet_living_room_right
      - switch.tv_room_window_lamps_switch
  - data:
      entity_id: input_boolean.alarm_state
    service: input_boolean.turn_off
  - service: light.turn_on
    data:
      entity_id: light.gateway_light_7811dcdf0cfa
      brightness_pct: 10
  - scene: scene.kitchen_passive
  initial_state: 'on'
  mode: single
- id: '1541183654317'
  alias: Coffee maker
  trigger:
  - entity_id: switch.outlet_kaffebryggaren
    for: '1800'
    platform: state
    to: 'on'
  condition: []
  action:
  - data:
      entity_id: switch.outlet_kaffebryggaren
    service: switch.turn_off
  initial_state: 'off'
- id: '1547903815352'
  alias: On reboot
  initial_state: 'on'
  trigger:
  - event: start
    platform: homeassistant
  condition:
  - condition: state
    entity_id: group.trusted_people
    state: not_home
  action:
  - data:
      entity_id: input_boolean.alarm_state
    service: input_boolean.turn_on
- id: '1550599967723'
  alias: Turn on stereo
  trigger:
  - entity_id: media_player.stereo_nere
    platform: state
    to: 'on'
  - entity_id: media_player.stereo_nere
    platform: state
    to: playing
  - entity_id: media_player.stereo_nere
    from: 'off'
    platform: state
    to: idle
  condition: []
  action:
  - data:
      entity_id: switch.outlet_stereo
    service: switch.turn_on
  mode: single
- id: '1550600530907'
  alias: Turn off stereo
  trigger:
  - entity_id: media_player.stereo_nere
    platform: state
    to: 'off'
  - entity_id: media_player.stereo_nere
    for: 00:15:00
    platform: state
    to: idle
  - entity_id: media_player.stereo_nere
    for: 00:15:00
    platform: state
    to: paused
  condition: []
  action:
  - data:
      entity_id: switch.outlet_stereo
    service: switch.turn_off
  mode: single
- id: '1555055523241'
  alias: Alarm - off
  trigger:
  - entity_id: input_boolean.sleeping
    from: 'on'
    platform: state
    to: 'off'
  - entity_id: group.trusted_people
    from: not_home
    platform: state
    to: home
  condition: []
  action:
  - data: {}
    service: input_boolean.turn_off
    target:
      entity_id:
      - input_boolean.alarm_state
      - input_boolean.upperfloor_alarm_state
  mode: single
- id: '1557508975938'
  alias: Doors - Basement opens
  trigger:
  - entity_id: binary_sensor.door_window_sensor_158d000313441b
    from: 'off'
    platform: state
    to: 'on'
  condition: []
  action:
  - data:
      entity_id: light.gateway_light_04cf8c9162cb
    service: light.turn_on
- id: '1557509032847'
  alias: Doors - Basement closes
  trigger:
  - entity_id: binary_sensor.door_window_sensor_158d000313441b
    for: 00:01:00
    from: 'on'
    platform: state
    to: 'off'
  condition: []
  action:
  - data:
      entity_id: light.gateway_light_04cf8c9162cb
    service: light.turn_off
- id: '1558249105875'
  alias: Sitting at the desk
  trigger:
  - event_data:
      entity_id: binary_sensor.vibration_158d0002afd810
      movement_type: tilt
    event_type: xiaomi_aqara.movement
    platform: event
  condition: []
  action:
  - data:
      brightness_pct: 100
    service: light.turn_on
    target:
      entity_id:
      - light.yeelight_color_0x5ed30a8
- id: '1558408108538'
  alias: Awaiting identification
  trigger:
  - entity_id: group.house_shell
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: group.trusted_people
    state: not_home
  action:
  - data:
      entity_id: input_boolean.identification_pending
    service: input_boolean.turn_on
- id: '1558638170121'
  alias: Doorbell ringing
  trigger:
  - event_data:
      click_type: single
      entity_id: binary_sensor.switch_158d0002ad8fad_doorbell
    event_type: xiaomi_aqara.click
    platform: event
  condition: []
  action:
  - service: input_boolean.turn_on
    entity_id: input_boolean.doorbell_ringing
  - delay: 00:00:15
  - service: input_boolean.turn_off
    entity_id: input_boolean.doorbell_ringing
  mode: single
- id: '1561103142057'
  alias: Water leak
  trigger:
  - entity_id: binary_sensor.water_leak_sensor_158d0002334525
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: binary_sensor.water_leak_sensor_158d00027955e3
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: binary_sensor.water_leak_sensor_158d0002837195
    from: 'off'
    platform: state
    to: 'on'
  condition: []
  action:
  - data:
      message: Bathroom or basement
      title: Water Leak alert
    service: notify.pushbullet_notifier
- id: '1561320522889'
  alias: Media - Play - cieling
  trigger:
  - entity_id: media_player.vardagsrum
    platform: state
    to: playing
  condition:
  - after: '18:00'
    before: 06:00
    condition: time
  - condition: state
    entity_id: light.tv_room_cieling_lights
    state: 'on'
  - condition: state
    entity_id: input_boolean.tv_room_light_switched_recently_pressed
    state: 'off'
  action:
  - data:
      entity_id: switch.moonlight
    service: switch.turn_on
  - data:
      brightness_pct: 5
      entity_id: light.tv_room_cieling_lights
    service: light.turn_on
- id: '1561567490842'
  alias: Media - Stop - cieling
  trigger:
  - entity_id: media_player.vardagsrum
    for: 0:00:15
    from: playing
    platform: state
    to: idle
  - entity_id: media_player.vardagsrum
    for: 0:00:15
    platform: state
    to: 'off'
  condition:
  - condition: state
    entity_id: light.tv_room_cieling_lights
    state: 'on'
  - after: '18:00'
    before: 06:00
    condition: time
  - condition: state
    entity_id: input_boolean.tv_room_light_switched_recently_pressed
    state: 'off'
  action:
  - data:
      entity_id: switch.moonlight
    service: switch.turn_on
  - data:
      brightness_pct: '60'
      entity_id: light.tv_room_cieling_lights
    service: light.turn_on
  mode: single
- id: '1561735682681'
  alias: Guest arrived
  trigger:
  - entity_id: binary_sensor.door_window_sensor_158d0002049a62
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: group.trusted_people
    state: not_home
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'on'
  action:
  - delay: 00:05:00
  - condition: state
    entity_id: group.trusted_people
    state: not_home
  - data:
      message: A guest arrived while noone was home
      title: Guest arrived
    service: notify.pushbullet_notifier
- id: '1562184118629'
  alias: Mark Tv-room lights as manually set
  trigger:
  - event_data:
      click_type: single
      entity_id: binary_sensor.switch_158d000215c957
    event_type: xiaomi_aqara.click
    platform: event
  - event_data:
      click_type: single
      entity_id: binary_sensor.switch_158d0002ad6c3a
    event_type: xiaomi_aqara.click
    platform: event
  - event_data:
      click_type: single
      entity_id: binary_sensor.wall_switch_left_158d00031af8a2
    event_type: xiaomi_aqara.click
    platform: event
  - event_data:
      click_type: single
      entity_id: binary_sensor.wall_switch_right_158d00031af8a2
    event_type: xiaomi_aqara.click
    platform: event
  condition: []
  action:
  - data:
      entity_id: input_boolean.tv_room_light_switched_recently_pressed
    service: input_boolean.turn_on
- id: '1562185409909'
  alias: 'Reset tv-room light manual mark '
  trigger:
  - entity_id: input_boolean.tv_room_light_switched_recently_pressed
    for: 02:00:00
    from: 'off'
    platform: state
    to: 'on'
  condition: []
  action:
  - data:
      entity_id: input_boolean.tv_room_light_switched_recently_pressed
    service: input_boolean.turn_off
- id: '1562186516375'
  alias: Alarm - Manual arm
  trigger:
  - entity_id: input_boolean.alarm_arming_pending
    for: 00:02:00
    from: 'off'
    platform: state
    to: 'on'
  condition: []
  action:
  - data:
      entity_id: input_boolean.alarm_arming_pending
    service: input_boolean.turn_off
  - data:
      entity_id: input_boolean.alarm_state
    service: input_boolean.turn_on
- id: '1562190311457'
  alias: Notification - Good morning
  trigger:
  - entity_id: input_boolean.sleeping
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - after: 06:00
    before: 08:00
    condition: time
  action:
  - data:
      entity_id: input_boolean.notification_goodmorning
    service: input_boolean.turn_on
- id: '1562220236800'
  alias: Notification - Clear good morning
  trigger:
  - entity_id: binary_sensor.motion_sensor_kitchen
    from: 'off'
    platform: state
    to: 'on'
  condition: []
  action:
  - delay: 00:00:05
  - data:
      entity_id: input_boolean.notification_goodmorning
    service: input_boolean.turn_off
- id: '1562224730116'
  alias: Alarm - Trigger
  trigger:
  - entity_id: group.motion_sensors
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: group.house_shell
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: input_boolean.alarm_state
    state: 'on'
  - condition: template
    value_template: '{{ states.automation.alarm_trigger.attributes.last_triggered
      == None or as_timestamp(now()) - as_timestamp(states.automation.alarm_trigger.attributes.last_triggered)
      > 900  }}'
  action:
  - delay: 00:02:00
  - condition: state
    entity_id: input_boolean.alarm_state
    state: 'on'
  - data:
      entity_id: input_boolean.alarm_triggered
    service: input_boolean.turn_on
  - data:
      message: 'Sensors: {{ expand(states.group.closed_windows.attributes.entity_id
        +  states.group.doors.attributes.entity_id  + states.group.motion_sensors.attributes.entity_id)     |
        selectattr(''last_changed'', ''ge'', now() - timedelta(minutes=10))     |
        map(attribute=''name'')    | list     | join('', '') }}'
      title: Larm utlöst
    service: notify.pushbullet_notifier
- id: '1562225953598'
  alias: Alarm - Disarm
  trigger:
  - entity_id: input_boolean.alarm_state
    from: 'on'
    platform: state
    to: 'off'
  - entity_id: input_boolean.upperfloor_alarm_state
    from: 'on'
    platform: state
    to: 'off'
  condition: []
  action:
  - data: {}
    service: input_boolean.turn_off
    target:
      entity_id:
      - input_boolean.alarm_triggered
      - input_boolean.identification_pending
  - after: 07:00
    condition: time
  - data:
      message: ''
      target:
      - channel/sundbyvik-larm
      title: Avlarmat
    service: notify.pushbullet_notifier
- id: '1562226659809'
  alias: Alarm - Arm house by leaving home
  trigger:
  - entity_id: group.trusted_people
    for: 00:10:00
    from: home
    platform: state
    to: not_home
  condition:
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  action:
  - data:
      message: 'Larmet är aktivt i hela huset. Orsak: ingen hemma'
      target:
      - channel/sundbyvik-larm
      title: Pålarmat
    service: notify.pushbullet_notifier
  - service: input_boolean.turn_on
    entity_id: input_boolean.alarm_state
  mode: single
- id: '1562227944523'
  alias: Alarm - Arm upper floor by leaving home
  trigger:
  - entity_id: group.trusted_people
    for: 00:10:00
    from: home
    platform: state
    to: not_home
  condition:
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'on'
  - condition: state
    entity_id: group.upper_floor_motion_sensors
    state: 'off'
  action:
  - data:
      entity_id: input_boolean.upperfloor_alarm_state
    service: input_boolean.turn_on
  - data:
      message: 'Larmet är aktivt på övervåningen. Orsak: Ingen hemma'
      target:
      - channel/sundbyvik-larm
      title: Delvis pålarmat
    service: notify.pushbullet_notifier
- id: '1562228115473'
  alias: Alarm - Trigger upstairs
  trigger:
  - entity_id: group.upper_floor_motion_sensors
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: input_boolean.upperfloor_alarm_state
    state: 'on'
  action:
  - delay: 00:00:30
  - condition: state
    entity_id: input_boolean.upperfloor_alarm_state
    state: 'on'
  - data:
      message: Övervåningen {{ expand(states.group.closed_windows.attributes.entity_id
        +  states.group.doors.attributes.entity_id  + states.group.motion_sensors.attributes.entity_id)     |
        selectattr('last_changed', 'ge', now() - timedelta(minutes=10))     | map(attribute='name')    |
        list     | join(', ') }}
      target:
      - channel/sundbyvik-larm
      title: Larm utlöst
    service: notify.pushbullet_notifier
  - data:
      entity_id: input_boolean.alarm_triggered
    service: input_boolean.turn_on
- id: '1562445668628'
  alias: Alarm - Manual semi arm
  trigger:
  - entity_id: input_boolean.alarm_semi_arming_pending
    for: 00:02:00
    from: 'off'
    platform: state
    to: 'on'
  condition: []
  action:
  - data:
      entity_id: input_boolean.alarm_semi_arming_pending
    service: input_boolean.turn_off
  - data:
      entity_id: input_boolean.upperfloor_alarm_state
    service: input_boolean.turn_on
- id: '1562446340139'
  alias: Sleep - Trigger wake up
  trigger:
  - entity_id: binary_sensor.motion_sensor_158d0003494ced
    from: 'off'
    platform: state
    to: 'on'
  condition: []
  action:
  - data:
      entity_id: input_boolean.sleeping
    service: input_boolean.turn_off
- id: '1562447214160'
  alias: Sleep - Trigger fall asleep
  trigger:
  - entity_id: binary_sensor.motion_sensor_upper_floor
    for: 00:15:00
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - condition: state
    entity_id: group.trusted_people
    state: home
  - after: '20:00'
    before: 07:00
    condition: time
  - condition: state
    entity_id: sensor.template_last_motion
    state: binary_sensor.motion_sensor_158d0003494ced
  action:
  - data: {}
    service: input_boolean.turn_on
    entity_id: input_boolean.sleeping
  mode: single
- id: '1562593639527'
  alias: Sleep - Force sleep trigger
  trigger:
  - entity_id: sensor.silent_at_night
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: group.trusted_people
    state: home
  - condition: state
    entity_id: input_boolean.sleeping
    state: 'off'
  action:
  - data:
      entity_id: input_boolean.sleeping
    service: input_boolean.turn_on
- id: '1562616685197'
  alias: Doors - recently closed
  trigger:
  - entity_id: group.doors
    from: 'on'
    platform: state
    to: 'off'
  condition: []
  action:
  - data:
      entity_id: input_boolean.doors_recently_closed
    service: input_boolean.turn_on
- id: '1562681351305'
  alias: Alarm - Arm house by sleeping
  trigger:
  - entity_id: input_boolean.sleeping
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  action:
  - data:
      message: 'Larmet är aktivt i hela huset. Orsak: sover'
      target:
      - channel/sundbyvik-larm
      title: Pålarmat
    service: notify.pushbullet_notifier
  - data:
      entity_id: input_boolean.alarm_state
    service: input_boolean.turn_on
- id: '1562681351309'
  alias: Alarm - Arm upper floor by sleeping
  trigger:
  - entity_id: input_boolean.sleeping
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'on'
  action:
  - data:
      entity_id: input_boolean.upperfloor_alarm_state
    service: input_boolean.turn_on
  - data:
      message: 'Larmet är aktivt på övervåningen. Orsak: sover'
      target:
      - channel/sundbyvik-larm
      title: Delvis pålarmat
    service: notify.pushbullet_notifier
- id: '1563472937399'
  alias: Switch - Single left off
  trigger:
  - event_data:
      click_type: single
      entity_id: binary_sensor.wall_switch_left_158d00031af8a2
    event_type: xiaomi_aqara.click
    platform: event
  - event_data:
      click_type: single
      entity_id: binary_sensor.switch_158d0002ad6c3a
    event_type: xiaomi_aqara.click
    platform: event
  condition:
  - condition: state
    entity_id: light.tv_room_cieling_lights
    state: 'on'
  - condition: state
    entity_id: input_boolean.ceiling_light_dimming
    state: 'off'
  - condition: state
    entity_id: input_boolean.ceiling_light_increasing
    state: 'off'
  action:
  - data:
      entity_id: light.tv_room_cieling_lights
    service: light.turn_off
- id: '1563473535525'
  alias: Switch - double left (normal)
  trigger:
  - event_data:
      click_type: double
      entity_id: binary_sensor.wall_switch_left_158d00031af8a2
    event_type: xiaomi_aqara.click
    platform: event
  - event_data:
      click_type: double
      entity_id: binary_sensor.switch_158d0002ad6c3a
    event_type: xiaomi_aqara.click
    platform: event
  condition:
  - condition: state
    entity_id: input_boolean.ceiling_yeelight_norml_mode
    state: 'off'
  action:
  - data:
      entity_id: switch.moonlight
    service: switch.turn_off
- id: '1563473535526'
  alias: Switch - double left (moonlight)
  trigger:
  - event_data:
      click_type: double
      entity_id: binary_sensor.wall_switch_left_158d00031af8a2
    event_type: xiaomi_aqara.click
    platform: event
  - event_data:
      click_type: double
      entity_id: binary_sensor.switch_158d0002ad6c3a
    event_type: xiaomi_aqara.click
    platform: event
  condition:
  - condition: state
    entity_id: input_boolean.ceiling_yeelight_norml_mode
    state: 'on'
  action:
  - data:
      entity_id: switch.moonlight
    service: switch.turn_on
- id: '1563475290805'
  alias: Switch - Single left on - day time
  trigger:
  - event_data:
      click_type: single
      entity_id: binary_sensor.wall_switch_left_158d00031af8a2
    event_type: xiaomi_aqara.click
    platform: event
  - event_data:
      click_type: single
      entity_id: binary_sensor.switch_158d0002ad6c3a
    event_type: xiaomi_aqara.click
    platform: event
  condition:
  - condition: state
    entity_id: light.tv_room_cieling_lights
    state: 'off'
  - condition: state
    entity_id: sun.sun
    state: above_horizon
  - condition: state
    entity_id: input_boolean.ceiling_light_dimming
    state: 'off'
  - condition: state
    entity_id: input_boolean.ceiling_light_increasing
    state: 'off'
  action:
  - data:
      brightness_pct: 70
      kelvin: 2700
    service: light.turn_on
    target:
      entity_id:
      - light.tv_room_cieling_lights
  - data:
      entity_id: switch.moonlight
    service: switch.turn_off
- id: '1563477770934'
  alias: Switch - Single click left on - evening time
  trigger:
  - event_data:
      click_type: single
      entity_id: binary_sensor.wall_switch_left_158d00031af8a2
    event_type: xiaomi_aqara.click
    platform: event
  - event_data:
      click_type: single
      entity_id: binary_sensor.switch_158d0002ad6c3a
    event_type: xiaomi_aqara.click
    platform: event
  condition:
  - condition: state
    entity_id: sun.sun
    state: below_horizon
  - condition: state
    entity_id: light.tv_room_cieling_lights
    state: 'off'
  - condition: state
    entity_id: input_boolean.ceiling_light_dimming
    state: 'off'
  - condition: state
    entity_id: input_boolean.ceiling_light_increasing
    state: 'off'
  - condition: time
    before: '23:00:00'
    after: 07:00:00
  action:
  - scene: scene.tv_room_evening
  - data:
      entity_id: switch.moonlight
    service: switch.turn_on
- id: '1563536402916'
  alias: Switch - Dim ceiling
  trigger:
  - event_data:
      click_type: long
      entity_id: binary_sensor.wall_switch_left_158d00031af8a2
    event_type: xiaomi_aqara.click
    platform: event
  - event_data:
      click_type: long_click_press
      entity_id: binary_sensor.switch_158d0002ad6c3a
    event_type: xiaomi_aqara.click
    platform: event
  condition:
  - condition: state
    entity_id: input_boolean.ceiling_light_dimming
    state: 'off'
  action:
  - data:
      entity_id: input_boolean.ceiling_light_dimming
    service: input_boolean.turn_on
  - data:
      entity_id: script.dim_up_lights
    service: script.turn_off
  - data:
      entity_id: input_boolean.ceiling_light_increasing
    service: input_boolean.turn_off
  - data:
      dimming_entity_id: input_boolean.ceiling_light_dimming
      light_entity_id: light.tv_room_cieling_lights
    service: script.dim_lights
- id: '1563547811367'
  alias: Switch - Single left turn off dimming
  trigger:
  - event_data:
      click_type: single
      entity_id: binary_sensor.wall_switch_left_158d00031af8a2
    event_type: xiaomi_aqara.click
    platform: event
  - event_data:
      click_type: single
      entity_id: binary_sensor.switch_158d0002ad6c3a
    event_type: xiaomi_aqara.click
    platform: event
  condition: []
  action:
  - data:
      entity_id: input_boolean.ceiling_light_increasing
    service: input_boolean.turn_off
  - data:
      entity_id: input_boolean.ceiling_light_dimming
    service: input_boolean.turn_off
  - data:
      entity_id: script.dim_lights
    service: script.turn_off
- id: '1563872455397'
  alias: Switch - Dim increase ceiling
  trigger:
  - event_data:
      click_type: long
      entity_id: binary_sensor.wall_switch_left_158d00031af8a2
    event_type: xiaomi_aqara.click
    platform: event
  - event_data:
      click_type: long_click_press
      entity_id: binary_sensor.switch_158d0002ad6c3a
    event_type: xiaomi_aqara.click
    platform: event
  condition:
  - condition: state
    entity_id: input_boolean.ceiling_light_increasing
    state: 'off'
  - condition: state
    entity_id: input_boolean.ceiling_light_dimming
    state: 'on'
  action:
  - data:
      entity_id: input_boolean.ceiling_light_dimming
    service: input_boolean.turn_off
  - data:
      entity_id: script.dim_lights
    service: script.turn_off
  - data:
      entity_id: input_boolean.ceiling_light_increasing
    service: input_boolean.turn_on
  - data:
      dimming_entity_id: input_boolean.ceiling_light_increasing
      light_entity_id: light.tv_room_cieling_lights
    service: script.dim_up_lights
- id: '1563895987902'
  alias: Doors - recently closed off
  trigger:
  - entity_id: input_boolean.doors_recently_closed
    for: 00:15:00
    platform: state
    to: 'on'
  condition: []
  action:
  - data:
      entity_id: input_boolean.doors_recently_closed
    service: input_boolean.turn_off
- id: '1563902354753'
  alias: Media - Stop - ceiling - 2
  trigger:
  - entity_id: media_player.vardagsrum
    for: 00:01:00
    from: playing
    platform: state
    to: idle
  - entity_id: media_player.vardagsrum
    for: 00:01:00
    platform: state
    to: 'off'
  condition:
  - condition: state
    entity_id: light.tv_room_cieling_lights
    state: 'on'
  - after: '18:00'
    before: 06:00
    condition: time
  - condition: state
    entity_id: input_boolean.tv_room_light_switched_recently_pressed
    state: 'off'
  action:
  - service: switch.turn_on
    entity_id: switch.moonlight
  - data:
      brightness_pct: '100'
      entity_id: light.tv_room_cieling_lights
    service: light.turn_on
  mode: single
- id: '1563472937313'
  alias: Switch - Single right off
  trigger:
  - event_data:
      click_type: single
      entity_id: binary_sensor.wall_switch_right_158d00031af8a2
    event_type: xiaomi_aqara.click
    platform: event
  condition:
  - condition: state
    entity_id: light.tvroom_lights
    state: 'on'
  - condition: state
    entity_id: input_boolean.tvroom_floor_light_dimming
    state: 'off'
  - condition: state
    entity_id: input_boolean.tvroom_floor_light_increasing
    state: 'off'
  action:
  - data:
      entity_id: light.tvroom_lights
    service: light.turn_off
- id: '1563472937314'
  alias: Switch - Single right on day time
  trigger:
  - event_data:
      click_type: single
      entity_id: binary_sensor.wall_switch_right_158d00031af8a2
    event_type: xiaomi_aqara.click
    platform: event
  condition:
  - condition: state
    entity_id: light.tvroom_lights
    state: 'off'
  - condition: time
    after: 07:00
  action:
  - data:
      entity_id: light.tvroom_lights
      color_temp: 431
      brightness_pct: 100
    service: light.turn_on
  mode: single
- id: '1563472937315'
  alias: Switch - Single right on night time
  trigger:
  - event_data:
      click_type: single
      entity_id: binary_sensor.wall_switch_right_158d00031af8a2
    event_type: xiaomi_aqara.click
    platform: event
  condition:
  - condition: state
    entity_id: light.tvroom_lights
    state: 'off'
  - condition: time
    before: 07:00
  action:
  - data:
      entity_id: light.tvroom_lights
      color_temp: 431
      brightness_pct: 10
    service: light.turn_on
  mode: single
- id: '1563536402999'
  alias: Switch - Dim floor lights
  trigger:
  - event_data:
      click_type: long
      entity_id: binary_sensor.wall_switch_right_158d00031af8a2
    event_type: xiaomi_aqara.click
    platform: event
  condition:
  - condition: state
    entity_id: input_boolean.tvroom_floor_light_dimming
    state: 'off'
  action:
  - data:
      entity_id: input_boolean.tvroom_floor_light_dimming
    service: input_boolean.turn_on
  - data:
      entity_id: script.dim_up_lights
    service: script.turn_off
  - data:
      entity_id: input_boolean.tvroom_floor_light_increasing
    service: input_boolean.turn_off
  - data:
      light_entity_id: light.tvroom_lights
      dimming_entity_id: input_boolean.tvroom_floor_light_dimming
    service: script.dim_lights
- id: '1563872455399'
  alias: Switch - Dim increase floor lights
  trigger:
  - event_data:
      click_type: long
      entity_id: binary_sensor.wall_switch_right_158d00031af8a2
    event_type: xiaomi_aqara.click
    platform: event
  condition:
  - condition: state
    entity_id: input_boolean.tvroom_floor_light_increasing
    state: 'off'
  - condition: state
    entity_id: input_boolean.tvroom_floor_light_dimming
    state: 'on'
  action:
  - data:
      entity_id: input_boolean.tvroom_floor_light_dimming
    service: input_boolean.turn_off
  - data:
      entity_id: script.dim_lights
    service: script.turn_off
  - data:
      entity_id: input_boolean.tvroom_floor_light_increasing
    service: input_boolean.turn_on
  - data:
      light_entity_id: light.tvroom_lights
      dimming_entity_id: input_boolean.tvroom_floor_light_increasing
    service: script.dim_up_lights
- id: '1563547812367'
  alias: Switch - Single right turn off dimming
  trigger:
  - event_data:
      click_type: single
      entity_id: binary_sensor.wall_switch_right_158d00031af8a2
    event_type: xiaomi_aqara.click
    platform: event
  condition: []
  action:
  - data:
      entity_id: input_boolean.tvroom_floor_light_increasing
    service: input_boolean.turn_off
  - data:
      entity_id: input_boolean.tvroom_floor_light_dimming
    service: input_boolean.turn_off
  - data:
      entity_id: script.dim_lights
    service: script.turn_off
- id: '1564683183178'
  alias: Switch - Hold cieling dimmer
  trigger:
  - event_data:
      click_type: hold
      entity_id: binary_sensor.switch_158d0002ad6c3a
    event_type: xiaomi_aqara.click
    platform: event
  condition: []
  action:
  - data:
      entity_id: script.dim_lights
    service: script.turn_off
- id: '1564683379644'
  alias: Switch - Force dimming off
  trigger:
  - entity_id: input_boolean.ceiling_light_dimming
    for: 00:01:00
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: input_boolean.ceiling_light_increasing
    for: 00:01:00
    from: 'off'
    platform: state
    to: 'on'
  condition: []
  action:
  - data:
      entity_id: input_boolean.ceiling_light_increasing
    service: input_boolean.turn_off
  - data:
      entity_id: input_boolean.ceiling_light_dimming
    service: input_boolean.turn_off
- id: '1564684465885'
  alias: Lights - Dimming - moonlight
  trigger:
  - platform: template
    value_template: '{{ (states.light.tv_room_cieling_lights.attributes.brightness
      or 50) < 50 }}'
  condition:
  - condition: state
    entity_id: input_boolean.ceiling_light_dimming
    state: 'on'
  - condition: state
    entity_id: input_boolean.ceiling_yeelight_norml_mode
    state: 'on'
  action:
  - data:
      entity_id: switch.moonlight
    service: switch.turn_on
  - data:
      brightness_pct: 100
      entity_id: light.tv_room_cieling_lights
    service: light.turn_on
- id: '1564684465886'
  alias: Lights - Dimming - Normal
  trigger:
  - platform: template
    value_template: '{{ (states.light.tv_room_cieling_lights.attributes.brightness
      or 0) >= 250 }}'
  condition:
  - condition: state
    entity_id: input_boolean.ceiling_light_increasing
    state: 'on'
  - condition: state
    entity_id: input_boolean.ceiling_yeelight_norml_mode
    state: 'off'
  action:
  - data:
      entity_id: switch.moonlight
    service: switch.turn_off
  - data:
      brightness_pct: 1
      entity_id: light.tv_room_cieling_lights
    service: light.turn_on
- id: '1569877083448'
  alias: Lights - Computer corner
  trigger:
  - entity_id: binary_sensor.motion_sensor_upper_floor
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: input_boolean.low_brightness_upstairs
    state: 'on'
  - condition: state
    entity_id: light.yeelight_color_0x5ed30a8
    state: 'off'
  action:
  - data:
      brightness_pct: 100
      kelvin: 2700
    service: light.turn_on
    target:
      entity_id:
      - light.yeelight_color_0x5ed30a8
- id: '1569877664790'
  alias: Brightness - Low upstairs
  trigger:
  - below: '15'
    entity_id: sensor.illumination_158d00023db6dc
    platform: numeric_state
  condition: []
  action:
  - data:
      entity_id: input_boolean.low_brightness_upstairs
    service: input_boolean.turn_on
- id: '1569877772042'
  alias: Brightness - High upstairs
  trigger:
  - above: '15'
    entity_id: sensor.illumination_158d00023db6dc
    platform: numeric_state
  - above: '15'
    entity_id: sensor.illumination_158d0003494ced
    platform: numeric_state
  condition:
  - above: '15'
    condition: numeric_state
    entity_id: sensor.illumination_158d00023db6dc
  - above: '15'
    condition: numeric_state
    entity_id: sensor.illumination_158d0003494ced
  action:
  - data:
      entity_id: input_boolean.low_brightness_upstairs
    service: input_boolean.turn_off
- id: '1569877920741'
  alias: Lights - Computer corner off
  trigger:
  - entity_id: binary_sensor.motion_sensor_upper_floor
    for: 00:15:00
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - after: sunrise
    before: sunset
    before_offset: -00:30
    condition: sun
  action:
  - service: light.turn_off
    data: {}
    target:
      entity_id:
      - light.yeelight_color_0x5ed30a8
- id: '1570208884470'
  alias: Doors - Entrance opens - Evening
  trigger:
  - entity_id: binary_sensor.door_window_sensor_158d0002049a62
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: sun.sun
    state: below_horizon
  action:
  - data:
      duration: 180000
      light: light.yeelight_color_0x5ed2368
    service: script.temp_max_light_yeelight
- id: '1572108824608'
  alias: Lights - Entrance hallway
  trigger:
  - entity_id: binary_sensor.motion_sensor_158d00036d598f
    platform: state
    to: 'on'
  - platform: state
    entity_id: binary_sensor.door_window_sensor_158d0002049a62
    to: 'on'
  condition: []
  action:
  - service: light.turn_on
    entity_id: light.hallway_lights
    data: {}
  mode: single
- id: '1572110432932'
  alias: Lights - Entrance Hallway off
  trigger:
  - entity_id: binary_sensor.motion_sensor_158d00036d598f
    for: 00:03:00
    platform: state
    to: 'off'
  - platform: state
    entity_id: binary_sensor.door_window_sensor_158d0002049a62
    to: 'off'
    for: 00:07:00
  condition:
  - condition: state
    entity_id: binary_sensor.motion_sensor_158d00036d598f
    state: 'off'
  action:
  - data: {}
    service: light.turn_off
    entity_id: light.hallway_lights
  mode: single
- id: '1570208884471'
  alias: Doors - Entrance open too long
  trigger:
  - entity_id: binary_sensor.door_window_sensor_158d0002049a62
    for: 00:01:00
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - below: '5'
    condition: numeric_state
    entity_id: sensor.dark_sky_temperature
  action:
  - data:
      entity_id: input_boolean.doors_entrance_open_too_long
    service: input_boolean.turn_on
- id: '1570208884472'
  alias: Doors - Entrance - close
  trigger:
  - entity_id: binary_sensor.door_window_sensor_158d0002049a62
    platform: state
    from: 'on'
    to: 'off'
  action:
  - data:
      entity_id: input_boolean.doors_entrance_open_too_long
    service: input_boolean.turn_off
- id: '1579966435947'
  alias: Doors - Garage door - opens
  trigger:
  - entity_id: binary_sensor.door_window_sensor_158d000428df78
    from: 'off'
    platform: state
    to: 'on'
  condition: []
  action:
  - data:
      entity_id: light.gateway_light_50ec50c6bb8e
    service: light.turn_on
- id: '1579966497413'
  alias: Doors - Garage door - Closed
  trigger:
  - entity_id: binary_sensor.door_window_sensor_158d000428df78
    for: 00:05:00
    from: 'on'
    platform: state
    to: 'off'
  condition: []
  action:
  - data:
      entity_id: light.gateway_light_50ec50c6bb8e
    service: light.turn_off
- id: '1598023301704'
  alias: Switch - Office cieling
  trigger:
  - event_data:
      click_type: single
      entity_id: binary_sensor.switch_158d000215c8ca
    event_type: xiaomi_aqara.click
    platform: event
  condition: []
  action:
  - service: light.toggle
    entity_id: light.office_lights
    data: {}
  - service: input_boolean.turn_on
    entity_id: input_boolean.officelight_manually_set
    data: {}
  mode: single
- id: '1598023740402'
  alias: Lights - Office cieling - On by motion
  trigger:
  - entity_id: binary_sensor.motion_sensor_upper_floor
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: input_boolean.low_brightness_upstairs
    state: 'on'
  - condition: state
    entity_id: group.office_cieling_light
    state: 'off'
  action:
  - data: {}
    service: script.turn_on_office_lights
  mode: single
- id: '1598959837638'
  alias: Lights - Office cieling off
  trigger:
  - entity_id: group.upper_floor_motion_sensors
    for: 00:15:00
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - condition: state
    entity_id: binary_sensor.binary_sensor_ping_andreas_work_laptop
    state: 'off'
  - condition: state
    entity_id: binary_sensor.binary_sensor_ping_johanna_work_laptop
    state: 'off'
  - condition: state
    entity_id: input_boolean.officelight_manually_set
    state: 'off'
  action:
  - service: light.turn_off
    data: {}
    entity_id: light.office_lights
  mode: single
- id: '1598960955397'
  alias: Reset Office light manual mark
  trigger:
  - entity_id: input_boolean.officelight_manually_set
    for: 05:00:00
    from: 'off'
    platform: state
    to: 'on'
  condition: []
  action:
  - data:
      entity_id: input_boolean.officelight_manually_set
    service: input_boolean.turn_off
- id: '1598961361932'
  alias: Media Upper floor - Play
  trigger:
  - entity_id: media_player.overvaning
    platform: state
    to: playing
  condition:
  - condition: state
    entity_id: group.office_cieling_light
    state: 'on'
  action:
  - data:
      brightness_pct: 10
      entity_id: group.office_cieling_light
    service: light.turn_on
  mode: single
- id: '1598961506630'
  alias: Media Upper floor - Stop
  trigger:
  - entity_id: media_player.overvaning
    for: 00:01:00
    from: playing
    platform: state
    to: idle
  - for: 00:01:00
    platform: state
    to: 'off'
    entity_id: media_player.overvaning
  condition:
  - condition: state
    entity_id: group.office_cieling_light
    state: 'on'
  action:
  - data:
      brightness_pct: 70
      entity_id: group.office_cieling_light
    service: light.turn_on
  mode: single
- id: '1601723199769'
  alias: Car - Engine heater - auto off
  trigger:
  - entity_id: switch.engineheater
    for: '2700'
    platform: state
    to: 'on'
  condition: []
  action:
  - service: switch.turn_off
    entity_id: switch.engineheater
    data: {}
  mode: single
- id: '1604495295561'
  alias: Lights - Office cieling - On by laptops
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.binary_sensor_ping_andreas_work_laptop
    to: 'on'
  - platform: state
    entity_id: binary_sensor.binary_sensor_ping_johanna_work_laptop
    to: 'on'
  condition:
  - condition: time
    after: 07:30
    before: '18:00'
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
  action:
  - service: script.turn_on_office_lights
    data: {}
  mode: single
- id: '1605531798053'
  alias: Lights - Playroom - On
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.motion_sensor_158d00053fcc36
    from: 'off'
    to: 'on'
  condition: []
  action:
  - service: light.turn_on
    data: {}
    entity_id: light.playroom_lights
  mode: single
- id: '1605531961559'
  alias: Lights - Playroom - Off
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.motion_sensor_158d00053fcc36
    from: 'on'
    to: 'off'
    for: 00:07:00
  condition: []
  action:
  - service: light.turn_off
    data: {}
    entity_id: light.playroom_lights
  mode: single
- id: '1606080819269'
  alias: Media - Baseline sound
  description: ''
  trigger:
  - platform: state
    entity_id: media_player.vardagsrum
    from: 'off'
  condition: []
  action:
  - service: media_player.volume_set
    data:
      volume_level: 0.23
    target:
      entity_id:
      - media_player.mtk8530
  mode: single
- id: '1608673020793'
  alias: Motion - Night - TV room
  description: ''
  trigger:
  - type: motion
    platform: device
    device_id: 8b0af8761d3211eba4c1ed791bcf32e3
    entity_id: binary_sensor.motion_sensor_158d00023db75a
    domain: binary_sensor
  condition:
  - condition: time
    after: '23:00'
    before: 07:00
  action:
  - type: turn_on
    device_id: 4a5d7ecc446411eb837211f387a5a096
    entity_id: switch.tv_room_window_lamps_switch
    domain: switch
  mode: single
- id: '1608722078148'
  alias: Car - Charging - Started
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.car_charging
    from: 'False'
    to: 'True'
  condition: []
  action:
  - service: light.turn_on
    data:
      rgb_color:
      - 0
      - 255
      - 0
      brightness_pct: '100'
    entity_id: light.gateway_light_50ec50c6bb8e
  - service: notify.pushbullet_notifier
    data:
      message: Car charging begun
      title: Car is charging
  - service: xiaomi_aqara.play_ringtone
    data:
      gw_mac: 50:EC:50:C6:BB:8E
      ringtone_id: 29
      ringtone_vol: 8
  - delay: 00:00:01
  - service: xiaomi_aqara.stop_ringtone
    data:
      gw_mac: 50:EC:50:C6:BB:8E
  - delay: 00:00:14
  - type: turn_off
    device_id: bfbc214b156d11ebbaef732b4b992e5d
    entity_id: light.gateway_light_50ec50c6bb8e
    domain: light
  mode: single
- id: '1608726715915'
  alias: Car - Charging - Ended
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.car_charging
    from: 'True'
    to: 'False'
  condition: []
  action:
  - service: light.turn_on
    data:
      rgb_color:
      - 255
      - 0
      - 0
      brightness_pct: '100'
    entity_id: light.gateway_light_50ec50c6bb8e
  - service: xiaomi_aqara.play_ringtone
    data:
      gw_mac: 50:EC:50:C6:BB:8E
      ringtone_id: 29
      ringtone_vol: 8
  - delay: 00:00:01
  - service: xiaomi_aqara.stop_ringtone
    data:
      gw_mac: 50:EC:50:C6:BB:8E
  - delay: 00:00:14
  - type: turn_off
    device_id: bfbc214b156d11ebbaef732b4b992e5d
    entity_id: light.gateway_light_50ec50c6bb8e
    domain: light
  - service: notify.pushbullet_notifier
    data:
      message: Car finished charging
      title: Car finished charging
  mode: single
- id: '1613069833201'
  alias: Doors - Front door unlocked
  description: ''
  trigger:
  - platform: state
    entity_id: lock.dorr
    to: unlocked
  condition: []
  action:
  - service: input_boolean.turn_on
    data: {}
    entity_id: input_boolean.front_door_unlocked
  - delay: 00:01:50
  - service: input_boolean.turn_off
    data: {}
    entity_id: input_boolean.front_door_unlocked
  mode: single
- id: '1618035182394'
  alias: AC Off
  description: ''
  trigger:
  - platform: state
    entity_id: media_player.vardagsrum
    to: playing
  condition:
  - condition: time
    after: '18:00'
    before: '23:59'
  action:
  - service: script.send_power_ac
  mode: single
- id: '1618346299747'
  alias: AC - On - cold
  description: ''
  trigger:
  - platform: state
    entity_id: input_boolean.sleeping
    from: 'off'
    to: 'on'
  condition: []
  action:
  - service: script.ac_on_cold
  mode: single
- id: '1628975592295'
  alias: Blinds - Close when warm and sunny
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.should_close_blinds
    to: 'False'
    from: 'True'
    for: 00:10:00
  condition:
  - condition: time
    after: 09:30
    before: '18:00:00'
  action:
  - device_id: 76d329213e6531314e86643974320d61
    domain: cover
    entity_id: cover.rd_intelligent_blindmotor_curtain
    type: set_position
    position: 0
  mode: single
- id: '1629009652404'
  alias: Blinds - Open cloudy
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.should_open_blinds
    to: 'True'
    for: 00:10:00
    from: 'False'
  condition:
  - condition: time
    after: 09:30
    before: '18:00:00'
  action:
  - device_id: 76d329213e6531314e86643974320d61
    domain: cover
    entity_id: cover.rd_intelligent_blindmotor_curtain
    type: set_position
    position: 100
  mode: single
- id: '1629044630083'
  alias: Blinds - Open morning
  description: ''
  trigger:
  - platform: time
    at: 09:15:00
  condition:
  - condition: state
    entity_id: input_boolean.sleeping
    state: 'off'
  action:
  - device_id: 76d329213e6531314e86643974320d61
    domain: cover
    entity_id: cover.rd_intelligent_blindmotor_curtain
    type: set_position
    position: 100
  mode: single
- id: '1632932769379'
  alias: 'Blinds - Close at night '
  description: ''
  trigger:
  - platform: time
    at: '21:30:00'
  condition: []
  action:
  - device_id: 76d329213e6531314e86643974320d61
    domain: cover
    entity_id: cover.rd_intelligent_blindmotor_curtain
    type: set_position
    position: 0
  mode: single
- id: '1636956079153'
  alias: 'Lights - Kitchen - Adjust to daytime '
  description: ''
  trigger:
  - platform: sun
    event: sunrise
    offset: '0'
  condition:
  - condition: state
    entity_id: light.kitchen_spotlights
    state: 'on'
  action:
  - scene: scene.kitchen_daytime
  mode: single
- id: '1636956179767'
  alias: Lights - Kitchen - Adjust to evening
  description: ''
  trigger:
  - platform: sun
    event: sunset
  condition:
  - condition: state
    entity_id: light.kitchen_spotlights
    state: 'on'
  action:
  - scene: scene.kitchen_nigthtime
  mode: single
- id: '1636958440127'
  alias: Lights - Kitchen - On daytime
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.motion_sensor_kitchen
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: light.kitchen_spotlights
    state: 'off'
  - condition: state
    entity_id: sun.sun
    state: above_horizon
  - condition: numeric_state
    entity_id: sensor.illumination_158d000276e193
    below: '300'
  action:
  - service: scene.turn_on
    target:
      entity_id: scene.kitchen_daytime
    data:
      transition: 3
  mode: single
- id: '1636958839522'
  alias: Lights - Kitchen - On Evening
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.motion_sensor_kitchen
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: light.kitchen_spotlights
    state: 'off'
  - condition: state
    entity_id: sun.sun
    state: below_horizon
  - condition: time
    before: '23:59'
  action:
  - service: scene.turn_on
    target:
      entity_id: scene.kitchen_nigthtime
    data:
      transition: 3
  mode: single
- id: '1636958937460'
  alias: 'Lights - Kitchen - On night '
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.motion_sensor_kitchen
    from: 'off'
    to: 'on'
  condition:
  - condition: numeric_state
    entity_id: light.kitchen_spotlights
    attribute: brightness
    below: '136'
  - condition: time
    after: 00:00
    before: 09:00
  - condition: state
    entity_id: sun.sun
    state: below_horizon
  action:
  - scene: scene.kitchen_passive
  - delay:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
  - service: scene.turn_on
    target:
      entity_id: scene.kitchen_nigthtime
    data:
      transition: 300
  mode: single
- id: '1636995387249'
  alias: Lights - Kitchen off
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.motion_sensor_kitchen
    from: 'on'
    to: 'off'
    for:
      hours: 0
      minutes: 20
      seconds: 0
      milliseconds: 0
  - platform: numeric_state
    entity_id: sensor.illumination_158d000276e193
    above: '300'
    for:
      hours: 0
      minutes: 1
      seconds: 0
      milliseconds: 0
  condition: []
  action:
  - service: light.turn_off
    target:
      entity_id: light.kitchen_spotlights
  mode: single
- id: '1637694506916'
  alias: Switch - Single click left on - night time
  description: ''
  trigger:
  - platform: event
    event_type: xiaomi_aqara.click
    event_data:
      click_type: single
      entity_id: binary_sensor.wall_switch_left_158d00031af8a2
  - platform: event
    event_type: xiaomi_aqara.click
    event_data:
      click_type: single
      entity_id: binary_sensor.switch_158d0002ad6c3a
  condition:
  - condition: or
    conditions:
    - condition: time
      after: '23:00'
    - condition: time
      before: 07:00
  - condition: state
    entity_id: light.tv_room_cieling_lights
    state: 'off'
  - condition: state
    entity_id: input_boolean.ceiling_light_dimming
    state: 'off'
  - condition: state
    entity_id: input_boolean.ceiling_light_increasing
    state: 'off'
  action:
  - scene: scene.tv_rum_passive
  - service: switch.turn_on
    target:
      entity_id: switch.moonlight
  mode: single
- id: '1637918108445'
  alias: Alarm - Deactivated
  description: ''
  trigger:
  - platform: state
    entity_id: input_boolean.alarm_state
    from: 'on'
    to: 'off'
  - platform: state
    entity_id: input_boolean.upperfloor_alarm_state
    from: 'on'
    to: 'off'
  condition: []
  action:
  - service: script.tts_long
    data:
      message: Alarm deactivated
  mode: single
- id: '1637918760419'
  alias: TTS Notification - Entrance open too long
  description: ''
  trigger:
  - platform: state
    entity_id: input_boolean.doors_entrance_open_too_long
    from: 'off'
    to: 'on'
  condition: []
  action:
  - service: script.tts_long
    data:
      message: Please consider closing the front door, it is cold outside
  mode: single
- id: '1637918923485'
  alias: TTS Notification - Doorbell
  description: ''
  trigger:
  - platform: state
    entity_id: input_boolean.doorbell_ringing
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: input_boolean.silent_mode
    state: 'on'
  action:
  - service: script.tts
    data:
      message: Pling plong, the doorbell is ringing
  mode: single
- id: '1637918923486'
  alias: TTS Notification - Please identify
  description: ''
  trigger:
  - platform: state
    entity_id: input_boolean.identification_pending
    from: 'off'
    to: 'on'
  condition: []
  action:
  - service: script.tts_long
    data:
      message: Your ID has not yet been established, please identify yourself as soon
        as possible
  mode: single
- id: '1637918923496'
  alias: TTS Notification - Identification complete
  description: ''
  trigger:
  - platform: state
    entity_id: input_boolean.identification_pending
    from: 'on'
    to: 'off'
  condition: []
  action:
  - service: script.tts_long
    data:
      message: Your identification has been approved
  mode: single
- id: '1637918923487'
  alias: TTS Notification - Basement leak
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.water_leak_sensor_158d0002334525
    from: 'off'
    to: 'on'
  condition: []
  action:
  - service: script.tts_long
    data:
      message: Attention! Possible water leak has been detected in the basement
  mode: single
- id: '1637918923488'
  alias: TTS Notification - Bathroom leak
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.water_leak_sensor_158d00027955e3
    from: 'off'
    to: 'on'
  condition: []
  action:
  - service: script.tts_long
    data:
      message: Attention! Possible water leak has been detected in the bathroom
  mode: single
- id: '1637918923489'
  alias: TTS Notification - Luandry room leak
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.water_leak_sensor_158d0002837195
    from: 'off'
    to: 'on'
  condition: []
  action:
  - service: script.tts_long
    data:
      message: Attention! Possible water leak has been detected in the luandry room
  mode: single
- id: '1638038537552'
  alias: TTS Notification - Good morning
  description: ''
  trigger:
  - platform: state
    entity_id: input_boolean.sleeping
    from: 'on'
    to: 'off'
  condition:
  - condition: time
    after: 06:00:00
    before: 09:00:00
  action:
  - wait_for_trigger:
    - platform: state
      entity_id: binary_sensor.motion_sensor_158d00023db75a
      from: 'off'
      to: 'on'
  - service: script.tts_long
    data:
      message: Good morning, I hope you will have a great day!
  mode: single
- id: '1638051606718'
  alias: 'TTS Notification - Welcome home Andreas '
  description: ''
  trigger:
  - platform: state
    entity_id: device_tracker.huawei_p30_pro_34dabc024f
    from: not_home
    to: home
  condition: []
  action:
  - wait_template: '{{ (as_timestamp(now()) - (as_timestamp(states.binary_sensor.door_window_sensor_158d0002049a62.last_changed)))
      < 300}}'
  - wait_for_trigger:
    - platform: state
      entity_id: binary_sensor.motion_sensor_158d00023db75a
      from: 'off'
      to: 'on'
    continue_on_timeout: true
    timeout: 00:01:00
  - service: script.tts_long
    data:
      message: Hello Andreas, welcome home
  mode: single
- id: '1638051606719'
  alias: TTS Notification - Welcome home Johanna
  description: ''
  trigger:
  - platform: state
    entity_id: device_tracker.johannas_galaxy_note20_5g
    from: not_home
    to: home
  condition: []
  action:
  - wait_template: '{{ (as_timestamp(now()) - (as_timestamp(states.binary_sensor.door_window_sensor_158d0002049a62.last_changed)))
      < 300}}'
  - wait_for_trigger:
    - platform: state
      entity_id: binary_sensor.motion_sensor_158d00023db75a
      from: 'off'
      to: 'on'
    continue_on_timeout: true
    timeout: 00:01:00
  - service: script.tts_long
    data:
      message: Hello Johanna, welcome home!
  mode: single
- id: '1638051606720'
  alias: TTS Notification - Welcome home Tina
  description: ''
  trigger:
  - platform: state
    entity_id: device_tracker.annchriesiphone
    from: not_home
    to: home
  condition: []
  action:
  - wait_template: '{{ (as_timestamp(now()) - (as_timestamp(states.binary_sensor.door_window_sensor_158d0002049a62.last_changed)))
      < 300}}'
  - wait_for_trigger:
    - platform: state
      entity_id: binary_sensor.motion_sensor_158d00023db75a
      from: 'off'
      to: 'on'
    continue_on_timeout: true
    timeout: 00:01:00
  - service: script.tts_long
    data:
      message: Hello Tina! Welcome back, enjoy your stay at our house
  mode: single
- id: '1638183197476'
  alias: Push Notification - Smoke detectors offline
  description: ''
  trigger:
  - type: battery_level
    platform: device
    device_id: 8b10a0e21d3211eb98646d678178e3f4
    entity_id: sensor.battery_158d000215ab06
    domain: sensor
    below: 10
  - type: battery_level
    platform: device
    device_id: 7bb3900d4a21171441cda5cdb6e6aea5
    entity_id: sensor.battery_158d00023117bb
    domain: sensor
    below: 10
  - type: battery_level
    platform: device
    device_id: 8b1215c21d3211eb95eaf71624720922
    entity_id: sensor.battery_158d0004119265
    domain: sensor
    below: 10
  - platform: state
    entity_id: binary_sensor.smoke_sensor_158d000215ab06
    to: unavailable
    for:
      hours: 0
      minutes: 15
      seconds: 0
      milliseconds: 0
  - platform: state
    entity_id: binary_sensor.smoke_sensor_158d00023117bb
    to: unavailable
    for:
      hours: 0
      minutes: 15
      seconds: 0
      milliseconds: 0
  - platform: state
    entity_id: binary_sensor.smoke_sensor_158d0004119265
    to: unavailable
    for:
      hours: 0
      minutes: 15
      seconds: 0
      milliseconds: 0
  condition: []
  action:
  - service: notify.pushbullet_notifier
    data:
      message: A smoke detector is either offline or running low on batteries
      title: 'Warning: Smoke detector failure'
  mode: single
